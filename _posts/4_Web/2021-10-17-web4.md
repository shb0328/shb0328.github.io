---
layout: "single"
title: "ìŠ¤í”„ë§ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ 4 - JPA"
categories: [Web]
tags: [Java, SpringBoot, JPA, ORM, Builder]
permalink: /web/4
---

# 3ì¥ ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ JPAë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë¤„ë³´ì

## ì–´ë–»ê²Œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆì„ê¹Œ?

**ë°˜ë³µì ì¸ SQL ì‘ì„± ë¬¸ì œ**

ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ê°€ ì›¹ ì„œë¹„ìŠ¤ì˜ ì¤‘ì‹¬ì´ ë˜ë©´ì„œ í˜„ì—… í”„ë¡œì íŠ¸ ëŒ€ë¶€ë¶„ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë³´ë‹¤ SQLë¡œ ê°€ë“í•´ì¡Œë‹¤.
ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ê°€ SQLë§Œ ì¸ì‹ì´ ê°€ëŠ¥í•˜ë‹ˆ í…Œì´ë¸”ë§ˆë‹¤ CRUDë¥¼ ë§¤ë²ˆ ìƒì„±í•´ì•¼í•œë‹¤.

**íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜ ë¬¸ì œ**

ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ëŠ” ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ì €ì¥í• ì§€ì— ì´ˆì ì´ ë§ì¶°ì§„ ê¸°ìˆ ì´ë‹¤.
ì¶”ìƒí™”, ìº¡ìŠí™”, ì •ë³´ì€ë‹‰, ë‹¤í˜•ì„± ë“± ê°ì²´ ì§€í–¥ì  ìš”ì†Œë“¤ì„ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œ í‘œí˜„í•˜ê¸°ëŠ” ì–´ë µë‹¤.
ê°ì²´ ëª¨ë¸ë§ë³´ë‹¤ëŠ” í…Œì´ë¸” ëª¨ë¸ë§ì—ë§Œ ì§‘ì¤‘í•˜ê³  ê°ì²´ë¥¼ ë‹¨ìˆœíˆ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì „ë‹¬ ì—­í• ë§Œ í•˜ëŠ” ê°œë°œì„ í•˜ê²Œëœë‹¤.

## ğŸ’œJPA
- ìë°” í‘œì¤€ ORM(Object Relational Mapping)
- ê°ì²´ì§€í–¥ íŒ¨ëŸ¬ë‹¤ì„ê³¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¤‘ê°„ì—ì„œ íŒ¨ëŸ¬ë‹¤ì„ ì¼ì¹˜ë¥¼ ì‹œì¼œì¤€ë‹¤.
- ê°œë°œìëŠ” ê°ì²´ì§€í–¥ì  í”„ë¡œê·¸ë˜ë°ì„ í•˜ê³ , JPAê°€ ì´ë¥¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ë§ê²Œ SQLì„ ëŒ€ì‹  ìƒì„±í•˜ê³  ì‹¤í–‰í•œë‹¤.

### ì¥ì 
- ìƒì‚°ì„± í–¥ìƒ
  - CRUD ì½”ë“œë¥¼ ì§ì ‘ ì‘ì„±í•  í•„ìš”ê°€ ì—†ë‹¤. 

### ë‹¨ì 
- ë†’ì€ ëŸ¬ë‹ ì»¤ë¸Œ
  - OOPì™€ RDBë¥¼ ë‘˜ ë‹¤ ì´í•´í•˜ê³  ìˆì–´ì•¼í•œë‹¤.

### ì†ë„ì´ìŠˆëŠ” ì—†ì„ê¹Œ?
- JPAì—ì„œ ì œì‹œí•˜ëŠ” ì—¬ëŸ¬ ì„±ëŠ¥ ì´ìŠˆ í•´ê²°ì±…ë“¤ì„ ì˜ í™œìš©í•˜ë©´ ì¶©ë¶„íˆ ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë§Œí¼ì˜ í¼í¬ë¨¼ìŠ¤ë¥¼ ë‚¼ ìˆ˜ ìˆë‹¤.

## ğŸ’œSpring Data JPA
JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. ì¦‰, Implementëœ êµ¬í˜„ì²´ê°€ í•„ìš”í•˜ë‹¤. 
ëŒ€í‘œì ì¸ êµ¬í˜„ì²´ëŠ” Hibernate, Eclipse Link ë“±ì´ ìˆë‹¤.
Springì—ì„œëŠ” ì´ êµ¬í˜„ì²´ë“¤ì„ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ê³ ì ì¶”ìƒí™”ì‹œí‚¨ **Spring Data JPA**ë¼ëŠ” ëª¨ë“ˆì„ ì œê³µí•œë‹¤.

- `JPA <- Hibernate <- Spring Data JPA`

#### Hibernate ëŒ€ì‹  Spring Data JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?
- êµ¬í˜„ì²´ êµì²´ ìš©ì´
  - ì–¸ì  ê°€ í•„ìš”ì— ë”°ë¼ Hibernate ë§ê³  ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆë‹¤.
- ì €ì¥ì†Œ êµì²´ ìš©ì´
  - ìµœì´ˆì— ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì¶œì‹œí–ˆë”ë¼ë„, ì˜ì¡´ì„±ë§Œ ìˆ˜ì •í•˜ë©´ MongoDB ë“± ë‹¤ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆë‹¤.

## ğŸ’œí”„ë¡œì íŠ¸ì— Spring Data JPA ì ìš©í•˜ê¸°

í”„ë¡œì íŠ¸ ë‚´ **build.gradle** íŒŒì¼ì— ë‹¤ìŒ ì˜ì¡´ì„± ì¶”ê°€

>Gradle 6.9.1 ë²„ì „ ê¸°ì¤€

```groovy

dependencies {
    ...

    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'com.h2database:h2'
    
    ...
}
```

ğŸ¥• **h2 Database?**

- ìë°” SQL ë°ì´í„°ë² ì´ìŠ¤
- in-memory ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤
- ë¹ ë¥¸ ì†ë„, [ì˜¤í”ˆì†ŒìŠ¤](https://github.com/h2database/h2database), JDBC API 
- 2.5MB ì •ë„ ì‚¬ì´ì¦ˆì˜ ì‘ì€ jar ì„¤ì¹˜ íŒŒì¼
  - ë³„ë„ì˜ ì„¤ì¹˜ì—†ì´ í”„ë¡œê·¸ë¨ ì˜ì¡´ì„±ìœ¼ë¡œë„ ê´€ë¦¬ê°€ëŠ¥
- ë¸Œë¼ìš°ì € ê¸°ë°˜ì˜ ì½˜ì†” ì• í”Œë¦¬ì¼€ì´ì…˜
  - ê¸°ë³¸ì ìœ¼ë¡œ `/h2-console`ì—ì„œ ì½˜ì†”ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. `spring.h2.console.path`ì†ì„± ì„ ë³€ê²½í•˜ì—¬ ì½˜ì†” ê²½ë¡œë¥¼ ì‚¬ìš©ìì •ì˜í•  ìˆ˜ ìˆë‹¤.
- ë©”ëª¨ë¦¬ì—ì„œ ì‹¤í–‰ë˜ì–´ í”„ë¡œê·¸ë¨ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”
  - JPA í…ŒìŠ¤íŠ¸ ë° ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìš©ë„

## ğŸ’œEntity Class

Entity í´ë˜ìŠ¤ë€ ì‹¤ì œ DBì™€ ë§¤ì¹­ë  í´ë˜ìŠ¤ì´ë‹¤.
ë°ì´í„° ìˆ˜ì •ì´ í•„ìš”í•  ê²½ìš°, DBì— ì‹¤ì œ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ì§€ ì•Šê³ , Entity í´ë˜ìŠ¤ì˜ ìˆ˜ì •ì„ í†µí•´ ì‘ì—…í•  ìˆ˜ ìˆë‹¤.

JPAì—ì„œ ì œê³µí•˜ëŠ” `@Entity` ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ Entity í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•´ì¤„ ìˆ˜ ìˆë‹¤.

```java
package hyep.study.springboot.domain.posts;

import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

/**
 * ì–´ë…¸í…Œì´ì…˜ ìˆœì„œ?
 *  ì£¼ìš” ì–´ë…¸í…Œì´ì…˜ì¸ @Entityë¥¼ í´ë˜ìŠ¤ ê°€ê¹Œì´ë‘”ë‹¤.
 *  ì½”í‹€ë¦° ë“± ìƒˆ ì–¸ì–´ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì „í™˜í•´ì•¼í•  ê²½ìš° í•„ìš”ì—†ì–´ì§„ Lombokì„ ì œê±°í•˜ê¸°ê°€ ë” ì‰½ë‹¤.
 **/
@Getter 
@NoArgsConstructor // == public Posts() {}
@Entity 
public class Posts {

    @Id
    @GeneratedValue
    private Long id;

    @Column(length = 500, nullable = false)
    private String title;

    @Column(columnDefinition = "TEXT", nullable = false)
    private String content;

    private String author;

    @Builder
    public Posts(String title, String content, String author) {
        this.title = title;
        this.content = content;
        this.author = author;
    }
}

```

### ğŸ˜²Entity í´ë˜ìŠ¤ëŠ” ì ˆëŒ€ Setter ë©”ì†Œë“œë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.

ìœ„ ì½”ë“œë¥¼ ë³´ë©´, `@Setter` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤.

ìë°”ë¹ˆ ê·œì•½ì— ë”°ë¼ `Getter/Setter`ë¥¼ ë¬´ì‘ì • ìƒì„±í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
ê·¸ëŸ¬ë©´, í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ê°’ë“¤ì´ ì–¸ì œ ì–´ë””ì„œ ì–´ë–»ê²Œ ë³€í•´ì•¼ í•˜ëŠ”ì§€ ì½”ë“œìƒìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„í•  ìˆ˜ê°€ ì—†ì–´ ì°¨í›„ ê¸°ëŠ¥ ë³€ê²½ì´ ì–´ë ¤ì›Œì§„ë‹¤.

ëŒ€ì‹ , í•´ë‹¹ í•„ë“œì˜ ê°’ ë³€ê²½ì´ í•„ìš”í•˜ë©´ ëª…í™•íˆ ê·¸ ëª©ì ê³¼ ì˜ë„ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ë©”ì†Œë“œë¥¼ ì¶”ê°€í•´ì•¼í•œë‹¤.

**ğŸ‘‰ì˜ˆì‹œ - ì£¼ë¬¸ ì·¨ì†Œ ì´ë²¤íŠ¸**

`Order` Entityì— ì£¼ë¬¸ì˜ ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” `status` í•„ë“œë¥¼ Setterë¥¼ í†µí•´ì„œ ë³€ê²½í•˜ë„ë¡ ì‘ì„±í•˜ëŠ” ê²½ìš°ì´ë‹¤.

ì£¼ë¬¸ ì·¨ì†Œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ `setStatus`ë¥¼ í†µí•´ì„œ `false`ê°’ì„ ë„˜ê¸°ëŠ”ë°, ì´ê²ƒì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ì½”ë“œìƒì— ëª…í™•íˆ ë“œëŸ¬ë‚˜ìˆì§€ ì•Šë‹¤.

```java
//ì˜ëª»ëœ Setter ì‚¬ìš© ì˜ˆ
public class Order {
  public void setStatus(boolean status) { //Setter
    this.status = status;
  }
}

public void ì£¼ë¬¸ì„œë¹„ìŠ¤ì˜_ì·¨ì†Œì´ë²¤íŠ¸() {
  order.setStatus(false);
}
```

ì•„ë˜ì™€ ê°™ì´ `cancelOrder` ë©”ì†Œë“œë¥¼ ì´ìš©í•´ì„œ `status` í•„ë“œ ê°’ ë³€ê²½ì˜ ëª©ì ê³¼ ì˜ë„ê°€ ëª…í™•íˆ ë“œëŸ¬ë‚˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.

```java
//ëª©ì ê³¼ ì˜ë„ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ë©”ì†Œë“œ
public class Order {
  public void cancelOrder() {
    this.status = false;
  }
}

public void ì£¼ë¬¸ì„œë¹„ìŠ¤ì˜_ì·¨ì†Œì´ë²¤íŠ¸() {
  order.cancelOrder();
}
```

ğŸ¥• **Setterê°€ ì—†ëŠ”ë°, ì–´ë–»ê²Œ ê°’ì„ ì±„ì›Œ DBì— insertí•  ìˆ˜ ìˆì„ê¹Œ?**

**1. Constructor(ìƒì„±ì)**
**2. Builder** 

ë‘ ë°©ë²• ëª¨ë‘ ìƒì„± ì‹œì ì— ê°’ì„ ì±„ìš°ëŠ” ì—­í• ì€ ê°™ë‹¤.<br>
í•˜ì§€ë§Œ **Builder**ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ë” ëª…í™•í•˜ê³  ì•ˆì „í•˜ë‹¤.

ì˜ˆë¥¼ë“¤ì–´, `Order` Entityì— ì£¼ë¬¸ ì •ë³´ ë°ì´í„°ë¥¼ ì„¸íŒ…í•˜ëŠ” ìƒì„±ìë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```java
public Order(int id, int itemCode, int payCode, boolean status) {
  this.id = id;
  this.itemCode = itemCode;
  this.payCode = payCode;
  this.status = status;
}
```

ì´ ë°©ë²•ì€ ì±„ì›Œì•¼í•  í•„ë“œê°€ ë¬´ì—‡ì¸ì§€ ëª…í™•í•˜ì§€ ì•Šì•„ ë””ë²„ê¹…ì´ ì–´ë µë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.

íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ëŠ” `id`, `itemCode`, `payCode`, `status`ì˜ *ìˆœì„œ*ë¥¼ ì˜ ì•Œê³ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ë©´, ì½”ë“œìƒì— ì•„ë˜ì™€ ê°™ì´ `Order` í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ì–´ ìˆì–´ë„ ë¬¸ì œë¥¼ ë°œê²¬í•˜ê¸° ì–´ë ¤ìš¸ ê²ƒì´ë‹¤.

```java
new Order(id, payCode, itemCode, status);
```

ë°˜ë©´ì—, Builderë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ëŠ í•„ë“œì— ì–´ë–¤ ê°’ì„ ì±„ì›Œì•¼í• ì§€ ëª…í™•í•˜ê²Œ ì¸ì§€í•  ìˆ˜ ìˆë‹¤.

```java
Order.builder()
     .id(id)
     .itemCode(itemCode)
     .payCode(payCode)
     .status(status)
     .build();
```

## ğŸ’œJPA Annotations

  - @Entity
  - @Id
  - @GeneratedValue 
  - @Column
    - êµ³ì´ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ í•´ë‹¹ í´ë˜ìŠ¤ì˜ í•„ë“œëŠ” ëª¨ë‘ ì»¬ëŸ¼ì´ ëœë‹¤.
    - ê¸°ë³¸ê°’(default value) ì™¸ì— ì¶”ê°€ë¡œ ë³€ê²½ì´ í•„ìš”í•œ ì˜µì…˜ì´ ìˆì„ ë•Œ ì‚¬ìš©í•œë‹¤.
    - [default value í™•ì¸í•˜ê¸°](https://www.objectdb.com/api/java/jpa/Column)

## ğŸ’œLombok Annotations

 - @NoArgsConstructor
 - @Builder

<br>

>Reference
- [ìŠ¤í”„ë§ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤](https://jojoldu.tistory.com/463)
- [JPA Reference](https://www.objectdb.com/api/java/jpa)
- [Spring Guide : Accessing data jpa](https://spring.io/guides/gs/accessing-data-jpa/)
- [H2 Database Engine](https://www.h2database.com/html/main.html)
- [MVN Repository : spring-boot-starter-data-jpa](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-data-jpa)
- [MVN Repository : com.h2database](https://mvnrepository.com/artifact/com.h2database/h2)
- [wannaqueen GitBook : 31.5 H2ì˜ ì›¹ ì½˜ì†” ì‚¬ìš©](https://wannaqueen.gitbook.io/spring5/spring-boot/undefined-1/31.-sql-by-ys/31.5-h2)
